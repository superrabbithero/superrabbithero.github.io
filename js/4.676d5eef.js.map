{"version":3,"file":"js/4.676d5eef.js","mappings":"uPACOA,MAAM,a,GAEJA,MAAM,iB,GACJA,MAAM,e,UACTC,EAAAA,EAAAA,GAAoB,aAAb,SAAK,K,GAGTD,MAAM,e,UACTC,EAAAA,EAAAA,GAAoB,aAAb,SAAK,K,GAITD,MAAM,e,UACTC,EAAAA,EAAAA,GAAuB,aAAhB,YAAQ,K,GAIZD,MAAM,e,UACTC,EAAAA,EAAAA,GAAkB,aAAX,OAAG,K,GACLD,MAAM,e,GACJE,MAAA,0B,GAUJF,MAAM,mB,uEA9BfG,EAAAA,EAAAA,IAmCM,MAnCNC,EAmCM,EAlCJH,EAAAA,EAAAA,GAAgH,UAAxGI,IAAI,aAAaC,MAAM,MAAMC,OAAO,MAAOP,OAAKQ,EAAAA,EAAAA,IAAA,4BAAmCC,EAAAC,Y,SAC3FT,EAAAA,EAAAA,GAgCM,MAhCNU,EAgCM,EA/BJV,EAAAA,EAAAA,GAGM,MAHNW,EAGM,CAFJC,GAAoB,SACpBZ,EAAAA,EAAAA,GAA0C,SAAnCa,KAAK,W,qCAAoBL,EAAAC,SAAQK,I,iBAARN,EAAAC,eAElCT,EAAAA,EAAAA,GAIM,MAJNe,EAIM,CAHJC,GACAhB,EAAAA,EAAAA,GAAsD,UAA9CD,MAAM,OAAQkB,QAAKC,EAAA,KAAAA,EAAA,OAAAC,IAAEC,EAAAC,cAAAD,EAAAC,gBAAAF,KAAc,OAC3CnB,EAAAA,EAAAA,GAAqD,UAA7CD,MAAM,OAAQkB,QAAKC,EAAA,KAAAA,EAAA,OAAAC,IAAEC,EAAAE,aAAAF,EAAAE,eAAAH,KAAa,SAE5CnB,EAAAA,EAAAA,GAIM,MAJNuB,EAIM,CAHJC,GACAxB,EAAAA,EAAAA,GAAkD,UAA1CD,MAAM,OAAQkB,QAAKC,EAAA,KAAAA,EAAA,OAAAC,IAAEC,EAAAK,SAAAL,EAAAK,WAAAN,KAAS,QACtCnB,EAAAA,EAAAA,GAAuD,UAA/CD,MAAM,OAAQkB,QAAKC,EAAA,KAAAA,EAAA,OAAAC,IAAEC,EAAAM,YAAAN,EAAAM,cAAAP,KAAY,YAE3CnB,EAAAA,EAAAA,GAYM,MAZN2B,EAYM,CAXJC,GACA5B,EAAAA,EAAAA,GASM,MATN6B,EASM,EARJ7B,EAAAA,EAAAA,GAEM,MAFN8B,EAEM,EADJ9B,EAAAA,EAAAA,GAAyE,UAAhEiB,QAAKC,EAAA,KAAAA,EAAA,OAAAC,IAAEC,EAAAW,WAAAX,EAAAW,aAAAZ,K,EAAWa,EAAAA,EAAAA,IAAqCC,EAAA,CAA3BC,KAAK,kBAE5ClC,EAAAA,EAAAA,GAIM,aAHJA,EAAAA,EAAAA,GAAoI,UAA3HmC,cAAWjB,EAAA,KAAAA,EAAA,GAAAJ,GAAEM,EAAAgB,WAAW,IAAKC,YAASnB,EAAA,KAAAA,EAAA,OAAAC,IAAEC,EAAAkB,UAAAlB,EAAAkB,YAAAnB,IAAWoB,eAAYrB,EAAA,KAAAA,EAAA,OAAAC,IAAEC,EAAAkB,UAAAlB,EAAAkB,YAAAnB,K,EAAUa,EAAAA,EAAAA,IAAuCC,EAAA,CAA7BC,KAAK,gBAAY,KAC/GlC,EAAAA,EAAAA,GAAwD,gBAAhDgC,EAAAA,EAAAA,IAAuCC,EAAA,CAA7BC,KAAK,kBACvBlC,EAAAA,EAAAA,GAAoI,UAA3HmC,cAAWjB,EAAA,KAAAA,EAAA,GAAAJ,GAAEM,EAAAgB,UAAU,IAAKC,YAASnB,EAAA,MAAAA,EAAA,QAAAC,IAAEC,EAAAkB,UAAAlB,EAAAkB,YAAAnB,IAAWoB,eAAYrB,EAAA,MAAAA,EAAA,QAAAC,IAAEC,EAAAkB,UAAAlB,EAAAkB,YAAAnB,K,EAAUa,EAAAA,EAAAA,IAAwCC,EAAA,CAA9BC,KAAK,iBAAa,WAIrHlC,EAAAA,EAAAA,GAGM,MAHNwC,EAA6B,QACxBC,EAAAA,EAAAA,IAAGC,KAAKC,IAAInC,EAAAoC,MAAMC,QAAQ,KAAM,SAC/BJ,EAAAA,EAAAA,IAAGjC,EAAAsC,KAAG,M,qCAOlB,GAEEC,IAAAA,GACE,MAAO,CACLtC,UAAS,EACTuC,aAAa,GACbC,UAAU,EACVC,WAAW,KACXC,IAAI,KACJC,OAAO,CAAC,EACRC,UAAU,CAAC,EACXC,QAAQ,0BACRC,OAAO,KACPC,OAAO,KACPC,SAAS,KACTC,SAAS,KACTd,MAAM,EACNe,QAAQ,EAERC,WAAW,CAAC,EACZC,iBAAiB,EACjBC,kBAAkB,EAClBC,kBAAmB,IAEnBC,eAAc,EACdlB,IAAI,GACJmB,YAAY,EAEhB,EACAC,OAAAA,GACEC,KAAKd,UAAY,IAAIe,IACrBD,KAAKf,OAAS,IAAIgB,IAClBD,KAAKP,WAAa,IAAIQ,IACtBD,KAAKE,mBACP,EACAC,OAAAA,GACEH,KAAKI,OACLC,OAAOC,iBAAiB,UAAWN,KAAKO,eACxCF,OAAOC,iBAAiB,QAASN,KAAKQ,YACxC,EACAC,SAAAA,GACEJ,OAAOK,oBAAoB,UAAWV,KAAKO,eAC3CF,OAAOK,oBAAoB,QAASV,KAAKQ,YAC3C,EACAG,QAAQ,CACNC,IAAAA,GACEZ,KAAKa,WAAW,OAAO,cAAc,CAACC,EAAE,GAAGC,EAAE,KAAK,UAClDf,KAAKa,WAAW,QAAQ,cAAc,CAACC,EAAE,GAAGC,EAAE,IAAI,UACpD,EACAzD,OAAAA,GACE0C,KAAKa,WAAW,OAAO,cAAc,CAACC,EAAE,GAAGC,EAAE,KAAK,SACpD,EACAxD,UAAAA,GACE,MAAMyD,EAAW,OAAShB,KAAKF,cAC/BE,KAAKrB,IAAMqC,EACXhB,KAAKa,WAAWG,EAAS,cAAc,CAACF,EAAG,GAAGd,KAAKF,YAAa,IAAIiB,EAAE,IAAI,UAC5E,EACAR,aAAAA,CAAcU,GAEZ,OADAC,QAAQvC,IAAK,QAAOsC,EAAME,OACnBF,EAAME,KACX,IAAK,IACHnB,KAAKpC,YACL,MACF,IAAK,aACgB,GAAhBoC,KAAKR,SACNQ,KAAK/B,UAAU,GACjB,MACF,IAAK,aACiB,GAAjB+B,KAAKR,SACNQ,KAAK/B,WAAW,GAClB,MAEN,EACAuC,WAAAA,CAAYS,GAEV,OADAC,QAAQvC,IAAK,MAAKsC,EAAME,OACjBF,EAAME,KACX,IAAK,aACHnB,KAAK7B,WACL,MACF,IAAK,YACH6B,KAAK7B,WACL,MAEN,EACAiC,IAAAA,GACEJ,KAAKjB,WAAaiB,KAAKoB,MAAMC,WAC7BrB,KAAKhB,IAAMgB,KAAKjB,WAAWuC,WAAW,MACtCtB,KAAKhB,IAAIuC,UAAY,CACvB,EACAtD,SAAAA,CAAUuD,GACRxB,KAAKT,UAAW,IAAIkC,MAAOC,UAC3B1B,KAAKR,QAAUgC,EACfN,QAAQvC,IAAIqB,KAAKT,SAAUS,KAAKR,QAClC,EACArB,QAAAA,GACE6B,KAAKR,QAAU,EACf0B,QAAQvC,IAAIqB,KAAKT,SAAUS,KAAKR,QAClC,EACAmC,IAAAA,GACE,MAAMC,EAAS5B,KAAKV,SAAW,EAAI,IAC7BuC,EAAK7B,KAAKV,SAAW,KAAQ,IAC7BwC,EAAO,EACb,GAAG9B,KAAKT,SAAS,CACf,MAAMwC,IAAM,IAAIN,MAAOC,UAAU1B,KAAKT,UAAW,IACjD,GAAGS,KAAKR,QAAU,EAAE,CAClBQ,KAAKvB,MAAQuB,KAAKvB,MAAQuB,KAAKR,SAASoC,EAASC,GAAIE,EACrD/B,KAAKvB,MAAQF,KAAKyD,IAAIhC,KAAKvB,MAAMqD,GACjC,IAAIG,EAAajC,KAAKd,UAAUgD,IAAI,QACpCD,EAAWE,SAASrB,GAAKd,KAAKvB,MAC9BuB,KAAKd,UAAUkD,IAAI,OAAQH,EAC7B,MAAM,GAAGjC,KAAKR,QAAU,EAAE,CACxBQ,KAAKvB,MAAQuB,KAAKvB,MAAQuB,KAAKR,SAASoC,EAASC,GAAIE,EACrD/B,KAAKvB,MAAQF,KAAK8D,IAAIrC,KAAKvB,OAAOqD,GAClC,IAAIG,EAAajC,KAAKd,UAAUgD,IAAI,QACpCD,EAAWE,SAASrB,GAAKd,KAAKvB,MAE9BuB,KAAKd,UAAUkD,IAAI,OAAQH,EAC7B,MACE,GAAGjC,KAAKvB,MAAQ,EAEd,GADAuB,KAAKvB,OAASoD,EAAGE,EACd/B,KAAKvB,MAAQ,EACduB,KAAKT,SAAW,KAChBS,KAAKvB,MAAQ,MACV,CACH,IAAIwD,EAAajC,KAAKd,UAAUgD,IAAI,QACpCD,EAAWE,SAASrB,GAAKd,KAAKvB,MAC9BuB,KAAKd,UAAUkD,IAAI,OAAQH,EAC7B,MAGA,GADAjC,KAAKvB,OAASoD,EAAGE,EACd/B,KAAKvB,MAAQ,EACduB,KAAKT,SAAW,KAChBS,KAAKvB,MAAQ,MACV,CACH,IAAIwD,EAAajC,KAAKd,UAAUgD,IAAI,QACpCD,EAAWE,SAASrB,GAAKd,KAAKvB,MAC9BuB,KAAKd,UAAUkD,IAAI,OAAQH,EAC7B,CAKN,CAGF,EACArE,SAAAA,GACMoC,KAAKV,WACPU,KAAKX,OAASW,KAAKd,UAAUgD,IAAI,QAAQC,SAASpB,EAClDf,KAAKV,UAAW,IAAImC,MAAOC,UAE/B,EACAY,IAAAA,GACE,MAAMC,GAAK,IACLC,EAAI,GACV,IAAIP,EAAajC,KAAKd,UAAUgD,IAAI,QACpC,MAAMO,EAAKzC,KAAKX,OACV0C,IAAM,IAAIN,MAAOC,UAAU1B,KAAKV,UAAW,IAC3CyB,EAAI0B,EAAKF,EAAER,EAAIS,EAAIT,EAAIA,EAC1BhB,EAAI0B,GACLR,EAAWE,SAASpB,EAAI0B,EACxBzC,KAAKd,UAAUkD,IAAI,OAAQH,GAC3BjC,KAAKV,SAAW,OAEhB2C,EAAWE,SAASpB,EAAIA,EACxBf,KAAKd,UAAUkD,IAAI,OAAQH,GAE/B,EAEApB,UAAAA,CAAW6B,EAAGC,EAAIR,EAASpE,GACtBiC,KAAKf,OAAO2D,IAAID,GACjB3C,KAAKd,UAAUkD,IAAIM,EAAG,CAACC,MAAIR,WAASU,cAAc,SAASC,eAAe,EAAE/E,SAE5EiC,KAAK+C,SAASJ,GAAKK,MAAMC,IAEvBjD,KAAKd,UAAUkD,IAAIM,EAAG,CAACC,MAAIR,WAASU,cAAc,SAASC,eAAe,EAAE/E,QAAM,IACjFmF,OAAOC,OAId,EACAC,YAAAA,CAAaV,GACX1C,KAAKd,UAAUmE,OAAOX,EACxB,EACAxF,YAAAA,GACuB,GAAlB8C,KAAKlB,YACNkB,KAAKlB,UAAYwE,sBAAsBtD,KAAKuD,yBAEhD,EACApG,WAAAA,GACEqG,qBAAqBxD,KAAKlB,WAC1BkB,KAAKlB,UAAY,CACnB,EACAyE,uBAAAA,CAAwBE,GAEtB,MAAMxB,EAAajC,KAAKd,UAAUgD,IAAI,QACflC,KAAKP,WAAWyC,IAAID,EAAWlE,MAAMkE,EAAWY,eAEpE7C,KAAKV,UACNU,KAAKsC,OAEPtC,KAAK2B,OAIF8B,EAAYzD,KAAKL,kBAAoBK,KAAKJ,oBAC3CI,KAAKhB,IAAI0E,UAAU,EAAE,EAAE,IAAI,KAG3B1D,KAAKd,UAAUyE,SAAQ,CAACC,EAAOzC,KAC7B,MAAM0C,EAAiB7D,KAAKP,WAAWyC,IAAI0B,EAAM7F,MAAM6F,EAAMf,eAC5C,UAAde,EAAM7F,KACPiC,KAAKhB,IAAI8E,UAAUD,EAAeD,EAAMd,gBAAgBc,EAAMzB,SAASrB,EAAE8C,EAAMzB,SAASpB,EAAE,IAAI,MAE9Ff,KAAKhB,IAAI8E,UAAUD,EAAeD,EAAMd,gBAAgBc,EAAMzB,SAASrB,EAAE8C,EAAMzB,SAASpB,EAAE,GAAG,IAC7Ff,KAAKrB,IAAO,GAAEiF,EAAMd,kBAAkBe,EAAeE,UAEvDH,EAAMd,gBAAkBc,EAAMd,eAAe,GAAIe,EAAeE,OAChE/D,KAAKd,UAAUkD,IAAIjB,EAAIyC,EAAM,IAG/B5D,KAAKL,kBAAoB8D,GAM3BzD,KAAKlB,UAAYwE,sBAAsBtD,KAAKuD,wBAC9C,EACA,cAAMR,CAASJ,GACb,GAAkC,OAA/BA,EAAIqB,MAAM,KAAKC,OAAO,GAAG,GAAY,CAEtC,MAAMC,QAAoBC,MAAMC,EAAAA,KAAAA,CAAS,KAAyBzB,MAC5D0B,QAAgBH,EAAYI,OAC5BC,GAAS,IAAIC,WAAYC,gBAAgBJ,EAAS,iBAClDK,EAAaH,EAAOI,cAAc,OAClCC,GAAU,IAAIC,eAAgBC,kBAAkBJ,GAChDK,EAAU,IAAIC,KAAK,CAACJ,GAAU,CAAElI,KAAM,gCACtCuI,EAASC,IAAIC,gBAAgBJ,GAC7BK,EAAS,IAAIC,MACbC,EAAOtF,KACboF,EAAOG,OAAS,WACdD,EAAKrG,OAAOmD,IAAIO,EAAKyC,GACrBF,IAAIM,gBAAgBP,EACtB,EACAG,EAAOK,IAAMR,CACf,KAAK,CAEH,MAAMS,EAAS,IAAIL,MACbC,EAAOtF,KACb0F,EAAOH,OAAS,WACdD,EAAKrG,OAAOmD,IAAIO,EAAK+C,EACvB,EACAA,EAAOD,IAAMrB,EAAAA,KAAAA,CAAS,KAAyBzB,IACjD,CACF,EACAzC,iBAAAA,CAAkByF,GAChB,MAAMC,EAAUxB,EAAAA,MAEhBwB,EAAQC,OAAOlC,SAASxC,IAEtB,MAAM2E,EAAY3E,EAAI4E,MAAM,kCAC5B,GAAID,EAAW,CACb,MAAME,EAAaF,EAAU,GACvBG,EAAcH,EAAU,GAEzB9F,KAAKP,WAAWmD,IAAIoD,IACvBhG,KAAKP,WAAW2C,IAAI4D,EAAY,CAAC,GAEnC,MAAME,EAAclG,KAAKP,WAAWyC,IAAI8D,GAEnCE,EAAYD,KACfC,EAAYD,GAAe,IAG7B,MAAME,EAAM,IAAId,MAChBc,EAAIZ,OAAS,KACXW,EAAYD,GAAaG,KAAKD,EAAI,EAEpCA,EAAIV,IAAMG,EAAQzE,GAElBnB,KAAKP,WAAW2C,IAAI4D,EAAYE,EAClC,KAGEP,GAAUA,GAChB,I,UC/TJ,MAAMU,GAA2B,OAAgB,EAAQ,CAAC,CAAC,SAASC,GAAQ,CAAC,YAAY,qBAEzF,O","sources":["webpack://augest/./src/components/gameDemo/theTurtleFamily.vue","webpack://augest/./src/components/gameDemo/theTurtleFamily.vue?68f4"],"sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <canvas ref=\"mainCanvas\" width=\"470\" height=\"720\" :class=\"{'game-canvas':true, 'gridsytle':showGrid}\" ></canvas>\r\n    <div class=\"button-groups\">\r\n      <div class=\"button-item\">\r\n        <label>显示网格：</label>\r\n        <input type=\"checkbox\" v-model=\"showGrid\">\r\n      </div>\r\n      <div class=\"button-item\">\r\n        <label>动画控制：</label>\r\n        <button class=\"fill\" @click=\"startAnimate\">开始</button>\r\n        <button class=\"fill\" @click=\"stopAnimate\">停止</button>\r\n      </div>\r\n      <div class=\"button-item\">\r\n        <label>测试方法的按钮：</label>\r\n        <button class=\"fill\" @click=\"addPopo\">加兔子</button>\r\n        <button class=\"fill\" @click=\"addPigCoin\">加一个硬币</button>\r\n      </div>\r\n      <div class=\"button-item\">\r\n        <label>方向：</label>\r\n        <div class=\"dir-contorl\">\r\n          <div style=\"margin-bottom: 10px;\">\r\n            <button @click=\"startJump\"><svg-icon name=\"arrow-up\"></svg-icon></button>\r\n          </div>\r\n          <div>\r\n            <button @pointerdown=\"startMove(-1)\" @pointerup=\"stopMove\" @pointerleave=\"stopMove\"><svg-icon name=\"arrow-left\"></svg-icon></button>  \r\n            <button><svg-icon name=\"arrow-down\"></svg-icon></button>      \r\n            <button @pointerdown=\"startMove(1)\" @pointerup=\"stopMove\" @pointerleave=\"stopMove\"><svg-icon name=\"arrow-right\"></svg-icon></button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"button-item log\">\r\n        速度：{{ Math.abs(moveV.toFixed(2)) }}\r\n        log:{{ log }}\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n\r\n  data(){\r\n    return {\r\n      showGrid:true,\r\n      mainGameData:[],\r\n      animateId:0,\r\n      maincanvas:null,\r\n      ctx:null,\r\n      srcMap:{},\r\n      objectMap:{},\r\n      srcPath:'@/assets/game-img/test/',\r\n      startX:null,\r\n      startY:null,\r\n      jumpTime:null,\r\n      moveTime:null,\r\n      moveV:0,\r\n      moveDir:0,\r\n      \r\n      idleFrames:{},//暂时保存一下帧动画\r\n      currentIdleFrame:0,\r\n      lastIdleFrameTime:0,\r\n      idleFrameDuration: 100, \r\n\r\n      IdleIndexFlag:false,\r\n      log:'',\r\n      objectNewId:0\r\n    }\r\n  },\r\n  created(){\r\n    this.objectMap = new Map()\r\n    this.srcMap = new Map()\r\n    this.idleFrames = new Map()\r\n    this.loadAllIdleFrames();\r\n  },\r\n  mounted(){\r\n    this.init()\r\n    window.addEventListener('keydown', this.handleKeyDown)\r\n    window.addEventListener('keyup', this.handleKeyUp)\r\n  },\r\n  unmounted(){\r\n    window.removeEventListener('keydown', this.handleKeyDown)\r\n    window.removeEventListener('keyup', this.handleKeyUp)\r\n  },\r\n  methods:{\r\n    test(){\r\n      this.pushObject('user','drawing.svg',{x:50,y:320},'paopao')\r\n      this.pushObject('coin1','drawing.svg',{x:50,y:50},'pigcoin')\r\n    },\r\n    addPopo(){\r\n      this.pushObject('user','drawing.svg',{x:50,y:320},'paopao')\r\n    },\r\n    addPigCoin(){\r\n      const objectId = 'coin' + this.objectNewId++\r\n      this.log = objectId\r\n      this.pushObject(objectId,'drawing.svg',{x:(50*this.objectNewId)%600,y:50},'pigcoin')\r\n    },\r\n    handleKeyDown(event){\r\n      console.log(`down:${event.key}`)\r\n      switch(event.key){\r\n        case ' ': \r\n          this.startJump();\r\n          break;\r\n        case 'ArrowRight': \r\n          if(this.moveDir != 1)\r\n            this.startMove(1) ;\r\n          break;\r\n        case 'ArrowLeft':\r\n          if(this.moveDir != -1) \r\n            this.startMove(-1) ;\r\n          break;\r\n      }\r\n    },\r\n    handleKeyUp(event){\r\n      console.log(`up:${event.key}`)\r\n      switch(event.key){\r\n        case 'ArrowRight': \r\n          this.stopMove() ;\r\n          break;\r\n        case 'ArrowLeft': \r\n          this.stopMove() ;\r\n          break;\r\n      }\r\n    },\r\n    init(){\r\n      this.maincanvas = this.$refs.mainCanvas;\r\n      this.ctx = this.maincanvas.getContext('2d');\r\n      this.ctx.lineWidth = 1\r\n    },\r\n    startMove(dir){\r\n      this.moveTime = new Date().getTime()\r\n      this.moveDir = dir\r\n      console.log(this.moveTime, this.moveDir)\r\n    },\r\n    stopMove(){\r\n      this.moveDir = 0\r\n      console.log(this.moveTime, this.moveDir)\r\n    },\r\n    move(){\r\n      const starta = this.jumpTime ? 0 : 0.05\r\n      const fa = this.jumpTime ? 0.001 : 0.01\r\n      const maxV = 5\r\n      if(this.moveTime){\r\n        const t = ((new Date().getTime()-this.moveTime))/100\r\n        if(this.moveDir > 0){\r\n          this.moveV = this.moveV + this.moveDir*(starta - fa)*t\r\n          this.moveV = Math.min(this.moveV,maxV)\r\n          let userObject = this.objectMap.get(\"user\")\r\n          userObject.position.x += this.moveV\r\n          this.objectMap.set('user', userObject)\r\n        }else if(this.moveDir < 0){\r\n          this.moveV = this.moveV + this.moveDir*(starta - fa)*t\r\n          this.moveV = Math.max(this.moveV,-maxV)\r\n          let userObject = this.objectMap.get(\"user\")\r\n          userObject.position.x += this.moveV\r\n          \r\n          this.objectMap.set('user', userObject)\r\n        }else{\r\n          if(this.moveV > 0){\r\n            this.moveV -= fa*t\r\n            if(this.moveV < 0){\r\n              this.moveTime = null\r\n              this.moveV = 0\r\n            }else{\r\n              let userObject = this.objectMap.get(\"user\")\r\n              userObject.position.x += this.moveV\r\n              this.objectMap.set('user', userObject)\r\n            }\r\n          }else{\r\n            this.moveV += fa*t\r\n            if(this.moveV > 0){\r\n              this.moveTime = null\r\n              this.moveV = 0\r\n            }else{\r\n              let userObject = this.objectMap.get(\"user\")\r\n              userObject.position.x += this.moveV\r\n              this.objectMap.set('user', userObject)\r\n            }\r\n          }\r\n        }\r\n        \r\n\r\n      }\r\n      \r\n      \r\n    },\r\n    startJump(){\r\n      if(!this.jumpTime){\r\n        this.startY = this.objectMap.get(\"user\").position.y\r\n        this.jumpTime = new Date().getTime()\r\n      }\r\n    },\r\n    jump(){\r\n      const v = -100 //跳跃初速度\r\n      const a = 10 //重力加速度\r\n      let userObject = this.objectMap.get(\"user\")\r\n      const y1 = this.startY\r\n      const t = ((new Date().getTime()-this.jumpTime))/100\r\n      const y = y1 + v*t + a * t * t\r\n      if(y > y1){\r\n        userObject.position.y = y1\r\n        this.objectMap.set('user', userObject)\r\n        this.jumpTime = null\r\n      }else{\r\n        userObject.position.y = y\r\n        this.objectMap.set('user', userObject)\r\n      }\r\n    },\r\n\r\n    pushObject(id,url,position,name){\r\n      if(this.srcMap.has(url)){\r\n        this.objectMap.set(id,{url,position,animationName:\"idle01\",animationIndex:0,name})\r\n      }else{\r\n        this.getImage(url).then((rs)=>{\r\n          // console.log(rs)\r\n          this.objectMap.set(id,{url,position,animationName:\"idle01\",animationIndex:0,name})\r\n        }).catch((err)=>{\r\n          // console.log(err)\r\n        })\r\n      }\r\n    },\r\n    deleteObject(id){\r\n      this.objectMap.delete(id)\r\n    },\r\n    startAnimate(){\r\n      if(this.animateId == 0){\r\n        this.animateId = requestAnimationFrame(this.updateMainCanvasAnimate)\r\n      }\r\n    },\r\n    stopAnimate(){\r\n      cancelAnimationFrame(this.animateId)\r\n      this.animateId = 0\r\n    },\r\n    updateMainCanvasAnimate(timestamp){\r\n      \r\n      const userObject = this.objectMap.get('user')\r\n      const userFramesList = this.idleFrames.get(userObject.name)[userObject.animationName]\r\n      //位移必须得实时刷新\r\n      if(this.jumpTime){\r\n        this.jump()\r\n      }\r\n      this.move()\r\n        \r\n      \r\n      //刷新帧动画\r\n      if(timestamp - this.lastIdleFrameTime > this.idleFrameDuration){\r\n        this.ctx.clearRect(0,0,720,480)\r\n        \r\n        \r\n        this.objectMap.forEach((value, key) => {\r\n          const idleFramesList = this.idleFrames.get(value.name)[value.animationName]\r\n          if(value.name == 'paopao'){\r\n            this.ctx.drawImage(idleFramesList[value.animationIndex],value.position.x,value.position.y,160,160)\r\n          }else{\r\n            this.ctx.drawImage(idleFramesList[value.animationIndex],value.position.x,value.position.y,75,75)\r\n            this.log = `${value.animationIndex},${idleFramesList.length}`\r\n          }\r\n          value.animationIndex = (value.animationIndex+1)%(idleFramesList.length)\r\n          this.objectMap.set(key,value)\r\n        })\r\n        // this.IdleIndexFlag = false\r\n        this.lastIdleFrameTime = timestamp;\r\n      }\r\n        \r\n      \r\n\r\n\r\n      this.animateId = requestAnimationFrame(this.updateMainCanvasAnimate)\r\n    },\r\n    async getImage(url) {\r\n      if(url.split('.').slice(-1)[0] == 'svg'){\r\n        // 加载SVG图像\r\n        const svgResponse = await fetch(require(`@/assets/game-img/test/${url}`));\r\n        const svgText = await svgResponse.text();\r\n        const svgDoc = new DOMParser().parseFromString(svgText, \"image/svg+xml\");\r\n        const svgElement = svgDoc.querySelector('svg');\r\n        const svgData = new XMLSerializer().serializeToString(svgElement);\r\n        const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });\r\n        const svgUrl = URL.createObjectURL(svgBlob);\r\n        const svgImg = new Image();\r\n        const that = this\r\n        svgImg.onload = function() {\r\n          that.srcMap.set(url, svgImg); \r\n          URL.revokeObjectURL(svgUrl);\r\n        };\r\n        svgImg.src = svgUrl;\r\n      }else{\r\n        // 加载PNG图像\r\n        const pngImg = new Image();\r\n        const that = this\r\n        pngImg.onload = function() {\r\n          that.srcMap.set(url, pngImg) \r\n        };\r\n        pngImg.src = require(`@/assets/game-img/test/${url}`); \r\n      }\r\n    },\r\n    loadAllIdleFrames(callback) {\r\n      const context = require.context('@/assets/game-img/test/animation/', true, /\\.png$/);\r\n\r\n      context.keys().forEach((key) => {\r\n        // 使用正则表达式从路径中提取 objectName 和 animateName\r\n        const pathMatch = key.match(/\\.\\/([^/]+)\\/([^/]+)\\/.+\\.png$/);\r\n        if (pathMatch) {\r\n          const objectName = pathMatch[1];\r\n          const animateName = pathMatch[2];\r\n\r\n          if (!this.idleFrames.has(objectName)) {\r\n            this.idleFrames.set(objectName, {});\r\n          }\r\n          const objectIdles = this.idleFrames.get(objectName);\r\n          \r\n          if (!objectIdles[animateName]) {\r\n            objectIdles[animateName] = [];\r\n          }\r\n\r\n          const img = new Image();\r\n          img.onload = () => {\r\n            objectIdles[animateName].push(img);\r\n          };\r\n          img.src = context(key);\r\n\r\n          this.idleFrames.set(objectName, objectIdles);\r\n        }\r\n      });\r\n\r\n      if (callback) callback();\r\n    }\r\n\r\n  }\r\n\r\n}\r\n  \r\n</script>\r\n\r\n<style scoped>\r\n  .container{\r\n    height: calc(100vh - 125px);\r\n  }\r\n\r\n  .game-canvas{\r\n    border: var(--box-border);\r\n    width: 480px;\r\n    height: 720px;\r\n    \r\n  }\r\n\r\n  .gridsytle{\r\n    background: linear-gradient(\r\n        -45deg,\r\n        #d9d9d9 25%,\r\n        transparent 25%,\r\n        transparent 75%,\r\n        #d9d9d9 75%,\r\n        #d9d9d9 100%\r\n      ),\r\n      linear-gradient(\r\n        -45deg,\r\n        #d9d9d9 25%,\r\n        transparent 25%,\r\n        transparent 75%,\r\n        #d9d9d9 75%,\r\n        #d9d9d9 100%\r\n      );\r\n    background-size: 10px 10px;\r\n    background-position: 0px 0px, 5px 5px;\r\n    background-color: white;\r\n  }\r\n\r\n  .button-groups {\r\n    width: 720px;\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    /* justify-content: center; */\r\n  }\r\n\r\n  .button-item{\r\n    margin: 10px;\r\n    display: flex;\r\n    align-items: center;\r\n  }\r\n  .button-item.log{\r\n    width: 100%;\r\n  }\r\n  .button-item button{\r\n    margin-right:10px;\r\n  }\r\n\r\n  .dir-contorl button{\r\n    padding: 5px;\r\n  }\r\n</style>\r\n\r\n","import { render } from \"./theTurtleFamily.vue?vue&type=template&id=49f1d9ed&scoped=true\"\nimport script from \"./theTurtleFamily.vue?vue&type=script&lang=js\"\nexport * from \"./theTurtleFamily.vue?vue&type=script&lang=js\"\n\nimport \"./theTurtleFamily.vue?vue&type=style&index=0&id=49f1d9ed&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-49f1d9ed\"]])\n\nexport default __exports__"],"names":["class","_createElementVNode","style","_createElementBlock","_hoisted_1","ref","width","height","_normalizeClass","$data","showGrid","_hoisted_2","_hoisted_3","_hoisted_4","type","$event","_hoisted_5","_hoisted_6","onClick","_cache","args","$options","startAnimate","stopAnimate","_hoisted_7","_hoisted_8","addPopo","addPigCoin","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","startJump","_createVNode","_component_svg_icon","name","onPointerdown","startMove","onPointerup","stopMove","onPointerleave","_hoisted_13","_toDisplayString","Math","abs","moveV","toFixed","log","data","mainGameData","animateId","maincanvas","ctx","srcMap","objectMap","srcPath","startX","startY","jumpTime","moveTime","moveDir","idleFrames","currentIdleFrame","lastIdleFrameTime","idleFrameDuration","IdleIndexFlag","objectNewId","created","this","Map","loadAllIdleFrames","mounted","init","window","addEventListener","handleKeyDown","handleKeyUp","unmounted","removeEventListener","methods","test","pushObject","x","y","objectId","event","console","key","$refs","mainCanvas","getContext","lineWidth","dir","Date","getTime","move","starta","fa","maxV","t","min","userObject","get","position","set","max","jump","v","a","y1","id","url","has","animationName","animationIndex","getImage","then","rs","catch","err","deleteObject","delete","requestAnimationFrame","updateMainCanvasAnimate","cancelAnimationFrame","timestamp","clearRect","forEach","value","idleFramesList","drawImage","length","split","slice","svgResponse","fetch","require","svgText","text","svgDoc","DOMParser","parseFromString","svgElement","querySelector","svgData","XMLSerializer","serializeToString","svgBlob","Blob","svgUrl","URL","createObjectURL","svgImg","Image","that","onload","revokeObjectURL","src","pngImg","callback","context","keys","pathMatch","match","objectName","animateName","objectIdles","img","push","__exports__","render"],"sourceRoot":""}