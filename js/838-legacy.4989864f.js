"use strict";(self["webpackChunkaugest"]=self["webpackChunkaugest"]||[]).push([[838],{69838:function(t,e,i){i.r(e),i.d(e,{default:function(){return W}});var s=i(19812),o=i(55893),n=i(89289),r=function(t){return(0,s.dD)("data-v-4eb081c1"),t=t(),(0,s.Cn)(),t},h={class:"tool-setting-bar"},a={class:"left"},l={class:"tool-option"},c={class:"label",style:{width:"91px"}},d={class:"right"},u={class:"icon-item"},g={class:"size"},v=r((function(){return(0,s._)("span",null,"x",-1)})),f={class:"icon-item"},w={class:"work-area"},p={class:"left"},x={class:"tools-bar"},m={class:"tool-item-fullscreen"},y={style:{position:"absolute",left:"1rem"}},C=["width","height"],S={class:"right"},z=["width","height"],R={class:"overview-tools"},D={class:"color-item draged",ref:"dragedColor"},P=["onPointerdown","onPointerup"],_={class:"color-item"};function k(t,e,i,r,k,b){var I=(0,s.up)("svg-icon");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s._)("div",h,[(0,s._)("div",a,[(0,s._)("div",l,[(0,s._)("div",c,"画笔大小("+(0,o.zw)(k.penSize)+"):",1),(0,s.wy)((0,s._)("input",{type:"range","onUpdate:modelValue":e[0]||(e[0]=function(t){return k.penSize=t}),min:"1",max:"20"},null,512),[[n.nr,k.penSize]])])]),(0,s._)("div",d,[(0,s._)("div",{class:"icon-item",onClick:e[1]||(e[1]=function(t){return k.toolsShow=!k.toolsShow})},[(0,s.Wm)(I,{name:"phone"})]),(0,s._)("div",{class:"icon-item",onClick:e[2]||(e[2]=function(){return b.undo&&b.undo.apply(b,arguments)})},[(0,s.Wm)(I,{name:"undo01"})]),(0,s._)("div",{class:"icon-item-box",onClick:e[5]||(e[5]=function(t){return b.dropDown(t,"sizeSettingShow")})},[(0,s._)("div",u,[(0,s.Wm)(I,{name:"canvas01"})]),(0,s._)("div",{class:(0,o.C_)({"size-setting":!0,show:k.dropDownBoxShow.sizeSettingShow})},[(0,s.Uk)(" 画布大小： "),(0,s._)("div",g,[(0,s.wy)((0,s._)("input",{type:"number","onUpdate:modelValue":e[3]||(e[3]=function(t){return k.rows=t})},null,512),[[n.nr,k.rows]]),v,(0,s.wy)((0,s._)("input",{type:"number","onUpdate:modelValue":e[4]||(e[4]=function(t){return k.cols=t})},null,512),[[n.nr,k.cols]])])],2)]),(0,s._)("div",{class:"icon-item-box",onClick:e[9]||(e[9]=function(t){return b.dropDown(t,"downloadShow")})},[(0,s._)("div",f,[(0,s.Wm)(I,{name:"download01"})]),(0,s._)("div",{class:(0,o.C_)({"size-setting":!0,show:k.dropDownBoxShow.downloadShow})},[(0,s._)("div",{class:"drop-down-option",onClick:e[6]||(e[6]=function(){return b.saveAsSvg&&b.saveAsSvg.apply(b,arguments)})},"保存成 svg"),(0,s._)("div",{class:"drop-down-option",onClick:e[7]||(e[7]=function(){return b.copySvgCode&&b.copySvgCode.apply(b,arguments)})},"复制 svg 代码"),(0,s._)("div",{class:"drop-down-option",onClick:e[8]||(e[8]=function(){return b.saveAsPng&&b.saveAsPng.apply(b,arguments)})},"保存成 png")],2)])])]),(0,s._)("div",w,[(0,s.wy)((0,s._)("div",p,[(0,s._)("div",x,[(0,s._)("div",{class:(0,o.C_)({"tool-item":!0,active:1==k.tool}),onClick:e[10]||(e[10]=function(t){return b.switchTool(1)})},[(0,s.Wm)(I,{name:"pencil",className:"tool-item-svg"})],2),(0,s._)("div",{class:(0,o.C_)({"tool-item":!0,active:2==k.tool}),onClick:e[11]||(e[11]=function(t){return b.switchTool(2)})},[(0,s.Wm)(I,{name:"eraser",className:"tool-item-svg"})],2),(0,s._)("div",{class:(0,o.C_)({"tool-item":!0,active:3==k.tool}),onClick:e[12]||(e[12]=function(t){return b.switchTool(3)})},[(0,s.Wm)(I,{name:"line",className:"tool-item-svg"})],2),(0,s._)("div",{class:(0,o.C_)({"tool-item":!0,active:4==k.tool}),onClick:e[13]||(e[13]=function(t){return b.switchTool(4)})},[(0,s.Wm)(I,{name:"rect",className:"tool-item-svg"})],2),(0,s._)("div",{class:(0,o.C_)({"tool-item":!0,active:5==k.tool}),onClick:e[14]||(e[14]=function(t){return b.switchTool(5)})},[(0,s.Wm)(I,{name:"circle",className:"tool-item-svg"})],2),(0,s._)("div",{class:(0,o.C_)({"tool-item":!0,active:6==k.tool}),onClick:e[15]||(e[15]=function(t){return b.switchTool(6)})},[(0,s.Wm)(I,{name:"paintBuckets",className:"tool-item-svg"})],2),(0,s._)("div",{class:(0,o.C_)({"tool-item":!0,active:7==k.tool}),onClick:e[16]||(e[16]=function(t){return b.switchTool(7)})},[(0,s.Wm)(I,{name:"select",className:"tool-item-svg"})],2),(0,s._)("div",{class:"tool-item",onClick:e[17]||(e[17]=function(){return b.clearAll&&b.clearAll.apply(b,arguments)})},[(0,s.Wm)(I,{name:"delete02",className:"tool-item-svg"})]),(0,s._)("div",m,[(0,s._)("div",{class:"color back",style:(0,o.j5)({backgroundColor:k.bkgColor}),onClick:e[18]||(e[18]=function(t){var e;return e=[k.bkgColor,k.currentColor],k.currentColor=e[0],k.bkgColor=e[1],e})},null,4),(0,s._)("div",{class:"color front",style:(0,o.j5)({backgroundColor:k.currentColor})},[(0,s._)("input",{type:"color",class:"colorInput-hidden",ref:"addColor1",onChange:e[19]||(e[19]=function(t){return b.addColor(t)})},null,544)],4)])])],512),[[n.F8,k.toolsShow]]),(0,s._)("div",{class:"middle",onPointermove:e[21]||(e[21]=function(){return b.handlePointerMove&&b.handlePointerMove.apply(b,arguments)}),onPointerup:e[22]||(e[22]=function(){return b.handlePointerUp&&b.handlePointerUp.apply(b,arguments)}),ref:"realViewport",onWheel:e[23]||(e[23]=function(){return b.zoomWheel&&b.zoomWheel.apply(b,arguments)})},[(0,s._)("div",y,(0,o.zw)(k.coordinate),1),(0,s._)("div",{class:"drawing-area",onPointerdown:e[20]||(e[20]=function(){return b.handlePointerDown&&b.handlePointerDown.apply(b,arguments)})},[(0,s._)("canvas",{width:b.width,height:b.height,class:"gridsytle",style:(0,o.j5)(b.canvasStyle),ref:"canvas"},null,12,C)],32)],544),(0,s.wy)((0,s._)("div",S,[(0,s._)("div",{class:"overview",onPointermove:e[25]||(e[25]=function(){return b.dragViewportMove&&b.dragViewportMove.apply(b,arguments)}),onPointerup:e[26]||(e[26]=function(){return b.dragViewportUp&&b.dragViewportUp.apply(b,arguments)}),onWheel:e[27]||(e[27]=function(){return b.zoomWheel&&b.zoomWheel.apply(b,arguments)})},[(0,s._)("canvas",{class:"gridsytle",ref:"canvas_overview",style:(0,o.j5)(b.overviewStyle),width:b.overviewSize.width,height:b.overviewSize.height},null,12,z),(0,s._)("div",{class:"viewport",ref:"viewport",onPointerdown:e[24]||(e[24]=function(){return b.dragViewportDown&&b.dragViewportDown.apply(b,arguments)})},null,544)],32),(0,s._)("div",R,[(0,s._)("div",{class:"icon-item",onClick:e[28]||(e[28]=function(){return b.zoomIn&&b.zoomIn.apply(b,arguments)})},[(0,s.Wm)(I,{name:"zoomIn"})]),(0,s._)("div",{class:"icon-item",onClick:e[29]||(e[29]=function(){return b.zoomOut&&b.zoomOut.apply(b,arguments)})},[(0,s.Wm)(I,{name:"zoomOut"})]),(0,s.wy)((0,s._)("input",{type:"range",style:{width:"80px"},min:"10",max:"100","onUpdate:modelValue":e[30]||(e[30]=function(t){return k.scaleCount=t}),onInput:e[31]||(e[31]=function(){return b.resizeViewport&&b.resizeViewport.apply(b,arguments)})},null,544),[[n.nr,k.scaleCount]]),(0,s._)("div",{class:"icon-item",onClick:e[32]||(e[32]=function(){return b.zoomFit&&b.zoomFit.apply(b,arguments)})},[(0,s.Wm)(I,{name:"fit01"})])]),(0,s._)("div",{class:"color-tools",ref:"colorTools",onPointermove:e[35]||(e[35]=function(e){return b.handleMove(e,t.index)})},[(0,s.wy)((0,s._)("div",D,null,512),[[n.F8,null!=k.dragedColorIndex]]),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(k.myColors,(function(t,e){return(0,s.wg)(),(0,s.iD)("div",{class:"color-item",ref_for:!0,ref:"colorItem",style:(0,o.j5)({backgroundColor:t}),onPointerdown:function(t){return b.handleStart(t,e)},onPointerup:function(t){return b.handleEnd(t,e)}},null,44,P)})),256)),(0,s._)("div",_,[(0,s.Uk)("+ "),(0,s._)("input",{type:"color",class:"colorInput-hidden",ref:"addColor2",onChange:e[33]||(e[33]=function(t){return b.addColor(t)})},null,544)]),(0,s._)("div",{class:(0,o.C_)({"color-item delete":!0,show:null!=k.dragedColorIndex}),onPointerup:e[34]||(e[34]=function(e){return b.handleEnd(t.event,-1)})},[(0,s.Wm)(I,{name:"delete02",className:"color-item-svg"})],34)],544)],512),[[n.F8,k.toolsShow]])])],64)}var b=i(80543),I=i(81448),M=i(27222),L=i(17519),T=(i(92222),i(40561),i(26699),i(32023),i(57658),i(47941),i(41539),i(54747),i(70189),i(78783),i(33948),i(47042),i(51532),i(60285),i(41637),i(46229),i(17330),i(62062),i(9653),{computed:{width:function(){return this.cols*this.gridSize},height:function(){return this.rows*this.gridSize},overviewSize:function(){var t=180,e=t/this.cols*this.rows;return e>140&&(e=140,t=e/this.rows*this.cols),{width:t,height:e}},overviewStyle:function(){var t=this.overviewSize.width/this.cols;return{backgroundSize:"".concat(2*t,"px ").concat(2*t,"px"),backgroundPosition:"0 0 , ".concat(t,"px ").concat(t,"px")}},canvasStyle:function(){var t=this.scaleCount/100,e=this.gridSize*t;return{width:"".concat(this.width*t,"px"),height:"".concat(this.height*t,"px"),backgroundSize:"".concat(2*e,"px ").concat(2*e,"px"),backgroundPosition:"0 0 , ".concat(e,"px ").concat(e,"px")}}},data:function(){return{tool:1,rows:5,cols:3,gridSize:100,coordinate:"x:0,y:0",currentColor:"#000",bkgColor:"#fff",myColors:["#000000","#ffffff","#f44336","#e91e63","#3f51b5","#00bcd4","#4caf50","#ffeb3b"],colorIndex:0,dragedColorIndex:null,isDrawing:!1,pixels:[],endPoints:{x:0,y:0},maincanvas:null,ctx:null,ovCtx:null,historys:[],log:"",shiftdown:!1,dropDownBox:null,dropDownBoxShow:{sizeSettingShow:!1,downloadShow:!1},penSize:1,scaleCount:30,minScaleCount:30,viewport:null,disx:0,disy:0,selectedRect:{x:0,y:0,width:0,height:0},offscreenCanvas:null,selectedImgData:null,selectedBgData:null,isDragingSelectRect:!1,selectRectAnimateId:0,pressTimer:null,toolsShow:!0}},mounted:function(){this.init(),window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp),this.$refs.realViewport.addEventListener("scroll",this.viewportScroll)},unmounted:function(){window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.handleKeyUp),this.$refs.realViewport&&this.$refs.realViewport.removeEventListener("scroll",this.viewportScroll),document.removeEventListener("click",this.closeDropDownBox)},methods:{handleStart:function(t,e){var i=this;this.pressTimer=setTimeout((function(){i.dragedColorIndex=e;var s=t.target;i.disx=t.pageX-s.offsetLeft,i.disy=t.pageY-s.offsetTop;var o=i.$refs.dragedColor;o.style.backgroundColor=i.myColors[i.dragedColorIndex],o.style.left="".concat(t.pageX-i.disx,"px"),o.style.top="".concat(t.pageY-i.disy,"px"),clearTimeout(i.pressTimer),i.pressTimer=null}),500)},handleMove:function(t,e){if(this.pressTimer&&(clearTimeout(this.pressTimer),this.pressTimer=null),null!=this.dragedColorIndex){var i=this.$refs.dragedColor;i.style.backgroundColor=this.myColors[this.dragedColorIndex],i.style.left="".concat(t.pageX-this.disx,"px"),i.style.top="".concat(t.pageY-this.disy,"px")}},handleEnd:function(t,e){if(this.pressTimer&&(clearTimeout(this.pressTimer),this.pressTimer=null,this.selectColor(e)),null!=this.dragedColorIndex)if(-1==e)this.myColors.splice(this.dragedColorIndex,1),this.dragedColorIndex=null;else{var i=this.myColors[e];this.myColors[e]=this.myColors[this.dragedColorIndex],this.myColors[this.dragedColorIndex]=i,this.dragedColorIndex=null}},selectColor:function(t){this.currentColor=this.myColors[t]},addColor:function(t){var e=t.currentTarget,i=e.value;this.myColors.includes(i)||this.myColors.push(i),this.currentColor=i},switchTool:function(t){this.tool!=t&&(7==this.tool&&(this.selectedImgData=null,this.selectedRect={x:0,y:0,width:0,height:0},cancelAnimationFrame(this.selectRectAnimateId),this.selectRectAnimateId=0,this.showLastHistory()),7==t&&(this.selectedBgData=this.ctx.getImageData(0,0,this.width,this.height)),this.tool=t)},updateOverview:function(){this.ovCtx.clearRect(0,0,this.overviewSize.width,this.overviewSize.height),this.ovCtx.drawImage(this.maincanvas,0,0,this.width,this.height,0,0,this.overviewSize.width,this.overviewSize.height)},dropDown:function(t,e){var i=this;this.dropDownBox=t.target;var s=Object.keys(this.dropDownBoxShow);s.forEach((function(t){i.dropDownBoxShow[t]=!1})),this.dropDownBoxShow[e]=!0,document.addEventListener("click",this.closeDropDownBox)},closeDropDownBox:function(t){var e=this;if(!this.dropDownBox.contains(t.target)){var i=Object.keys(this.dropDownBoxShow);i.forEach((function(t){e.dropDownBoxShow[t]=!1})),document.removeEventListener("click",this.closeDropDownBox)}},switchColor:function(t){var e=this.getColorAtPixel(t),i="rgba("+e.r+","+e.g+","+e.b+","+e.a+")";"rgba(0,0,0,0)"!=i&&(this.currentColor=i)},handleKeyDown:function(t){"Shift"===t.key&&(this.shiftdown=!0)},handleKeyUp:function(t){"Shift"===t.key&&(this.shiftdown=!1)},init:function(){window.PointerEvent&&(this.log="Pointer events are supported."),this.maincanvas=this.$refs.canvas;var t=this.$refs.canvas_overview;this.ctx=this.maincanvas.getContext("2d"),this.ctx.lineWidth=5,this.ovCtx=t.getContext("2d"),this.addHistory(),this.resizeViewport(),this.getMinScale(),this.scaleCount=this.minScaleCount,this.offscreenCanvas=document.createElement("canvas")},getMinScale:function(){var t=this.$refs.realViewport,e=t.clientWidth,i=e/this.cols*this.rows;i>t.clientHeight&&(i=t.clientHeight,e=i/this.rows*this.cols),this.minScaleCount=Math.floor(100*e/this.width),this.log=this.minScaleCount},handlePointerDown:function(t){if(this.endPoints=this.getPoint({x:t.clientX,y:t.clientY}),2==this.tool)this.isDrawing=!0,this.clearPixel(this.endPoints);else if(this.tool<6)this.isDrawing=!0,this.drawPixel(this.endPoints);else if(6==this.tool)this.ctx.fillStyle=this.currentColor,this.fillArea(this.endPoints),this.addHistory();else if(7==this.tool){this.ctx.beginPath(),this.ctx.rect(this.selectedRect.x,this.selectedRect.y,this.selectedRect.width,this.selectedRect.height),this.ctx.closePath();var e=this.ctx.isPointInPath(this.endPoints.x,this.endPoints.y);if(e){if(this.selectedImgData)this.ctx.putImageData(this.selectedBgData,0,0);else{this.showLastHistory(),this.selectedImgData=this.ctx.getImageData(this.selectedRect.x,this.selectedRect.y,this.selectedRect.width,this.selectedRect.height),this.offscreenCanvas.width=this.selectedRect.width,this.offscreenCanvas.height=this.selectedRect.height;var i=this.offscreenCanvas.getContext("2d");this.showLastHistory(),this.ctx.clearRect(this.selectedRect.x,this.selectedRect.y,this.selectedRect.width,this.selectedRect.height),this.selectedBgData=this.ctx.getImageData(0,0,this.width,this.height),i.putImageData(this.selectedImgData,0,0)}this.disx=this.endPoints.x-this.selectedRect.x,this.disy=this.endPoints.y-this.selectedRect.y,this.isDragingSelectRect=!0,this.ctx.drawImage(this.offscreenCanvas,this.selectedRect.x-1,this.selectedRect.y-1)}else this.showLastHistory(),0==this.selectRectAnimateId&&(this.selectRectAnimateId=requestAnimationFrame(this.dashedRectAnimate)),this.selectedImgData=null,this.selectedRect={x:0,y:0,width:0,height:0},this.selectedBgData=this.ctx.getImageData(0,0,this.width,this.height),this.isDrawing=!0}},handlePointerMove:function(t){this.ctx.fillStyle=this.currentColor,this.ctx.strokeStyle=this.currentColor;var e=this.getPoint({x:t.clientX,y:t.clientY});this.isDrawing?1==this.tool?(this.drawLine(this.endPoints,e),this.endPoints=e):2==this.tool?this.clearPixel(e):3==this.tool?(this.showLastHistory(),this.drawLine(this.endPoints,e)):4==this.tool?(this.showLastHistory(),this.drawRect(this.endPoints,e)):5==this.tool?(this.showLastHistory(),this.drawPixelEllipse(this.endPoints,e)):7==this.tool&&(this.showLastHistory(),this.select(this.endPoints,e)):7==this.tool&&this.isDragingSelectRect?(this.selectedRect.x=e.x-this.disx,this.selectedRect.y=e.y-this.disy):this.tool<6&&(this.showLastHistory(),this.overMove(e))},select:function(t,e){var i=Math.min(t.x,e.x),s=Math.min(t.y,e.y),o=Math.abs(e.x-t.x)+this.gridSize,n=Math.abs(e.y-t.y)+this.gridSize;this.selectedRect={x:i,y:s,width:o,height:n}},drawDashedRect:function(){this.ctx.lineDashOffset=(this.ctx.lineDashOffset+1)%100,this.ctx.setLineDash([0]),this.ctx.strokeStyle="#fff",this.ctx.strokeRect(this.selectedRect.x-5,this.selectedRect.y-5,this.selectedRect.width+10,this.selectedRect.height+10),this.ctx.setLineDash([50]),this.ctx.strokeStyle="#000",this.ctx.strokeRect(this.selectedRect.x-5,this.selectedRect.y-5,this.selectedRect.width+10,this.selectedRect.height+10),this.ctx.fillStyle="rgba(0,0,0,0.3)",this.ctx.fillRect(this.selectedRect.x,this.selectedRect.y,this.selectedRect.width,this.selectedRect.height),this.ctx.fillStyle=this.currentColor},dashedRectAnimate:function(){this.ctx.putImageData(this.selectedBgData,0,0),this.selectedRect.width*this.selectedRect.height!=0&&this.drawDashedRect(),this.selectedImgData&&this.ctx.drawImage(this.offscreenCanvas,this.selectedRect.x,this.selectedRect.y),this.selectRectAnimateId=requestAnimationFrame(this.dashedRectAnimate)},selectSave:function(){this.ctx.putImageData(this.selectedBgData,0,0),this.ctx.drawImage(this.offscreenCanvas,0,0,this.selectedRect.width,this.selectedRect.height,this.selectedRect.x,this.selectedRect.y,this.selectedRect.width,this.selectedRect.height),this.addHistory()},handlePointerUp:function(){this.isDrawing&&(this.isDrawing=!1,7==this.tool?this.selectedRect.width*this.selectedRect.height==0&&(cancelAnimationFrame(this.selectRectAnimateId),this.selectRectAnimateId=0,this.selectedRect={x:0,y:0,width:0,height:0},this.selectedImgData=null):this.addHistory()),this.isDragingSelectRect&&(this.isDragingSelectRect=!1,this.selectSave())},drawPixel:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.penSize;this.ctx.fillStyle=this.currentColor;var i=t.x/this.gridSize-Math.floor(e/2),s=t.y/this.gridSize-Math.floor(e/2);this.ctx.fillRect(this.gridSize*i,this.gridSize*s,this.gridSize*e,this.gridSize*e)},overMove:function(t){this.ctx.fillStyle="rgba(0,0,0,0.3)";var e=this.penSize,i=t.x/this.gridSize-Math.floor(e/2),s=t.y/this.gridSize-Math.floor(e/2);this.ctx.fillRect(this.gridSize*i,this.gridSize*s,this.gridSize*e,this.gridSize*e)},clearPixel:function(t){var e=this.penSize,i=t.x/this.gridSize-Math.floor(e/2),s=t.y/this.gridSize-Math.floor(e/2);this.ctx.clearRect(this.gridSize*i,this.gridSize*s,this.gridSize*e,this.gridSize*e)},drawLine:function(t,e){var i=t.x,s=t.y,o=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y),r=t.x<e.x?this.gridSize:-this.gridSize,h=t.y<e.y?this.gridSize:-this.gridSize,a=o-n;while(1){if(this.drawPixel({x:i,y:s}),i===e.x&&s===e.y)break;var l=2*a;l>-n&&(a-=n,i+=r),l<o&&(a+=o,s+=h)}},drawRect:function(t,e){var i,s;if(this.shiftdown){var o=e.x-t.x,n=e.y-t.y,r=Math.min(Math.abs(o),Math.abs(n));e=o>0&&n>0?{x:t.x+r,y:t.y+r}:o>0&&n<0?{x:t.x+r,y:t.y-r}:o<0&&n>0?{x:t.x-r,y:t.y+r}:{x:t.x-r,y:t.y-r}}i={x:e.x,y:t.y},s={x:t.x,y:e.y},this.drawLine(t,i),this.drawLine(s,e),this.drawLine(t,s),this.drawLine(i,e)},drawPixelEllipse:function(t,e){var i=(t.x+e.x)/2/this.gridSize+.5,s=Math.abs((e.x-t.x)/this.gridSize/2),o=e.y>t.y?s:-s,n=this.shiftdown?t.y/this.gridSize+o+.5:(t.y+e.y)/2/this.gridSize+.5,r=this.shiftdown?s:Math.abs((e.y-t.y)/this.gridSize/2),h=s%1?.5:0,a=r,l=Math.ceil(r*r-s*s*r+.25*s*s),c=2*r*r*h,d=2*s*s*a;this.drawEllipsePoints(i,n,h,a);while(c<d)h++,c+=2*r*r,l<=0?l+=c+r*r:(a--,d-=2*s*s,l+=c-d+r*r),this.drawEllipsePoints(i,n,h,a);var u=Math.ceil(r*r*(h+.5)*(h+.5)+s*s*(a-1)*(a-1)-s*s*r*r);while(a>0)a--,d-=2*s*s,u<=0?(h++,c+=2*r*r,u+=r*r-d+c):u+=s*s-d,this.drawEllipsePoints(i,n,h,a)},drawEllipsePoints:function(t,e,i,s){t-=.5,e-=.5,this.drawPixel({x:(t+i)*this.gridSize,y:(e-s)*this.gridSize}),this.drawPixel({x:(t-i)*this.gridSize,y:(e-s)*this.gridSize}),this.drawPixel({x:(t-i)*this.gridSize,y:(e+s)*this.gridSize}),this.drawPixel({x:(t+i)*this.gridSize,y:(e+s)*this.gridSize})},fillArea:function(t){var e=this.getColorAtPixel(t),i=this.hexToArgb(this.ctx.fillStyle);if(!this.colorsMatch(e,i)){var s=[t],o=this.$refs.canvas,n=o.width,r=o.height,h=new Set,a=function(t,e){return"".concat(t,",").concat(e)};while(s.length){var l=s.pop(),c=l.x,d=l.y,u=this.getColorAtPixel({x:c,y:d});!h.has(a(c,d))&&this.colorsMatch(u,e)&&(this.drawPixel({x:c,y:d},1),h.add(a(c,d)),c>0&&s.push({x:c-this.gridSize,y:d}),c<n-this.gridSize&&s.push({x:c+this.gridSize,y:d}),d>0&&s.push({x:c,y:d-this.gridSize}),d<r-this.gridSize&&s.push({x:c,y:d+this.gridSize}))}}},getColorAtPixel:function(t){var e=this.ctx.getImageData(t.x,t.y,1,1),i=e.data;return i.slice(0,4)},hexToArgb:function(t){"#"===t[0]&&(t=t.slice(1));var e=parseInt(t,16);return 8===t.length?[e>>24&255,e>>16&255,e>>8&255,255&e]:6===t.length?[255,e>>16&255,e>>8&255,255&e]:4===t.length?[e>>12&255,e>>8&255,e>>4&255,255&e]:3===t.length?[255,e>>8&255,e>>4&255,255&e]:[0,0,0,0]},colorsMatch:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},clearAll:function(){this.selectedRect={x:0,y:0,width:0,height:0},this.selectedImgData=null,this.ctx.clearRect(0,0,this.width,this.height),cancelAnimationFrame(this.selectRectAnimateId),this.selectRectAnimateId=0,this.addHistory()},isRectEqual:function(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height},getPoint:function(t){var e=this.scaleCount/100,i=this.$refs.canvas.getBoundingClientRect(),s=Math.floor((t.x-i.left)/this.gridSize/e)*this.gridSize,o=Math.floor((t.y-i.top)/this.gridSize/e)*this.gridSize;return this.coordinate="x:".concat(s/this.gridSize,",y:").concat(o/this.gridSize),{x:s,y:o}},showLastHistory:function(){var t=this.historys,e=t[t.length-1]["data"];this.ctx.putImageData(e,0,0)},addHistory:function(){this.historys.push({data:this.ctx.getImageData(0,0,this.width,this.height)}),this.updateOverview()},undo:function(){var t=this.historys;t&&t.length>1&&(t.pop(),this.showLastHistory(),this.updateOverview()),this.selectedImgData=null,this.selectedRect={x:0,y:0,width:0,height:0},cancelAnimationFrame(this.selectRectAnimateId),this.selectRectAnimateId=0},getPixelVector:function(t){var e=this,i=30,s="rgba(".concat(t.r,",").concat(t.g,",").concat(t.b,",").concat(t.a,")"),o={x:t.x,y:t.y},n={x:t.x+i,y:t.y},r={x:t.x+i,y:t.y+i},h={x:t.x,y:t.y+i},a=function(t,i){return t+i*e.rows};return[[a(o.x,o.y),a(n.x,n.y),s],[a(n.x,n.y),a(r.x,r.y),s],[a(r.x,r.y),a(h.x,h.y),s],[a(h.x,h.y),a(o.x,o.y),s]]},getpathContent:function(t){var e=this,i=[],s=new Map;t.forEach((function(t){var i=e.getPixelVector(t);i.forEach((function(t){if(s.has(t[0]))if(s.has(t[1])){for(var e=s.get(t[1]),i=null,o=0;o<e.length;o++)if(e[o][0]==t[0]&&e[o][1]==t[2]){i=e.splice(o,1),e.length>0?s.set(t[1],e):s.delete(t[1]);break}if(null==i){var n=s.get(t[0]).push([t[1],t[2]]);s[(t[0],n)]}}else{var r=s.get(t[0]).push([t[1],t[2]]);s[(t[0],r)]}else s.set(t[0],[[t[1],t[2]]])}))}));var o=function t(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(console.log("findPath(\n".concat(e,",\n").concat(o,",\n").concat(n,")")),s.has(e)){var r=s.get(e);if(null==n){var h=r.splice(0,1)[0];s.set(e,r),r.length<=0&&s.delete(e),o=[e,h[0]],t(h[0],o,h[1])}else{for(var a=s.get(e),l=null,c=0;c<a.length;c++)if(a[c][1]==n){l=a.splice(c,1)[0],s.set(e,a),a.length<=0&&s.delete(e);break}if(l)o.push(l[0]),t(l[0],o,l[1]);else{if(o.push(n),i.push(o),!(s.size>0))return;var d=s.keys().next().value,u=s.get(d)[0];t(u[0])}}}else if(n){if(o.push(n),i.push(o),!(s.size>0))return;var g=s.keys().next().value,v=s.get(g)[0];t(v[0])}},n=s.keys().next().value;o(n);var r="",h=new Map,a=function(t){var i=t%(30*e.rows);return{x:i,y:Math.floor((t-i)/e.rows)}};i.forEach((function(t){for(var e=a(t[0]),i={direction:"M",step:0},s="M".concat(e.x," ").concat(e.y),o=1;o<t.length-1;o++){var n=a(t[o]);e.x==n.x?"v"==i.direction?i.step+=n.y-e.y:(0!=i.step&&(s+="".concat(i.direction).concat(i.step)),i.direction="v",i.step=n.y-e.y):"h"==i.direction?i.step+=n.x-e.x:(0!=i.step&&(s+="".concat(i.direction).concat(i.step)),i.direction="h",i.step=n.x-e.x),e.x=n.x,e.y=n.y}s+="z";var r=t[t.length-1];if(h.has(r)){var l=h.get(r);l.push(s),h.set(r,l)}else h.set(r,[s])}));var l,c=(0,L.Z)(h);try{var d=function(){var t=(0,M.Z)(l.value,2);u=t[0],g=t[1];var e='<path d="';g.forEach((function(t){e+=t})),e+='" fill="'.concat("rgba(0,0,0,255)"==u?"currentColor":u,'"/>'),r+=e};for(c.s();!(l=c.n()).done;){var u,g;d()}}catch(v){c.e(v)}finally{c.f()}return console.log(r),r},getSvgContent:function(){for(var t=this.width,e=this.height,i=this.ctx.getImageData(0,0,t,e),s=i.data,o=[],n=0;n<e;n+=this.gridSize)for(var r=0;r<t;r+=this.gridSize){var h=4*(n*t+r),a=s[h],l=s[h+1],c=s[h+2],d=s[h+3];d>0&&o.push({x:.3*r,y:.3*n,r:a,g:l,b:c,a:d})}var u='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 '.concat(.3*t," ").concat(.3*e,'">');return u+=this.getpathContent(o),u+="</svg>",u},copySvgCode:function(){var t=this.getSvgContent();this.copyToClipboard(t)},saveAsSvg:function(){var t=this.getSvgContent(),e=new Blob([t],{type:"image/svg+xml"}),i=URL.createObjectURL(e),s=document.createElement("a");s.href=i,s.download="drawing.svg",s.click(),URL.revokeObjectURL(i)},saveAsPng:function(){var t=document.createElement("a"),e=this.maincanvas.toDataURL("image/png");t.href=e,t.download="drawing.png",t.click(),URL.revokeObjectURL(e)},copyToClipboard:function(t){var e=this;return(0,I.Z)((0,b.Z)().mark((function i(){return(0,b.Z)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,navigator.clipboard.writeText(t);case 3:e.$toast.show("复制成功","success"),i.next=9;break;case 6:i.prev=6,i.t0=i["catch"](0),e.$toast.show(i.t0,"error");case 9:case"end":return i.stop()}}),i,null,[[0,6]])})))()},dragViewportDown:function(t){this.$refs.realViewport.removeEventListener("scroll",this.viewportScroll),this.viewport=this.$refs.viewport,this.disx=t.pageX-this.viewport.offsetLeft,this.disy=t.pageY-this.viewport.offsetTop,this.resizeViewport()},dragViewportMove:function(t){if(this.viewport){var e=this.$refs.canvas_overview,i=this.$refs.realViewport,s=e.clientWidth/this.maincanvas.clientWidth,o=t.pageX-this.disx,n=t.pageY-this.disy,r=e.offsetLeft+e.clientWidth-this.viewport.clientWidth-2,h=e.offsetTop+this.viewport.parentElement.clientHeight-this.viewport.clientHeight-2;o=Math.max(e.offsetLeft,Math.min(o,r)),n=Math.max(e.offsetTop,Math.min(n,h)),this.viewport.style.left=o+"px",this.viewport.style.top=n+"px",this.log="".concat(e.offsetLeft);var a=(o-e.offsetLeft)/s,l=(n-e.offsetTop)/s;i.scrollTop=l,i.scrollLeft=a}},dragViewportUp:function(){this.$refs.realViewport.addEventListener("scroll",this.viewportScroll),this.viewport&&(this.viewport=null)},viewportScroll:function(){this.log="".concat(this.$refs.realViewport.scrollTop,",").concat(this.$refs.realViewport.scrollLeft),this.resizeViewport()},zoomWheel:function(t){t.preventDefault();var e=t.deltaY;if(e<0){var i=Number(this.scaleCount)+1;this.scaleCount=Math.min(i,100)}else{i=Number(this.scaleCount)-1;this.scaleCount=Math.max(i,10)}this.resizeViewport()},zoomIn:function(){var t=Number(this.scaleCount)+10;this.scaleCount=Math.min(t,100),this.resizeViewport()},zoomOut:function(){var t=Number(this.scaleCount)-10;this.scaleCount=Math.max(t,10),this.resizeViewport()},zoomFit:function(){this.getMinScale(),this.scaleCount=this.minScaleCount,this.resizeViewport()},resizeViewport:function(){var t=this,e=this.$refs.canvas_overview,i=this.$refs.realViewport,s=e.clientWidth/this.maincanvas.clientWidth;this.$nextTick((function(){var o=i.clientWidth*s,n=i.clientHeight*s;t.$refs.viewport.style.width="".concat(Math.floor(Math.min(o,e.clientWidth)),"px"),t.$refs.viewport.style.height="".concat(Math.floor(Math.min(n,e.clientHeight)-1),"px");var r=t.$refs.canvas_overview.offsetTop+t.$refs.realViewport.scrollTop*s,h=t.$refs.canvas_overview.offsetLeft+t.$refs.realViewport.scrollLeft*s;t.$refs.viewport.style.top="".concat(r,"px"),t.$refs.viewport.style.left="".concat(h,"px")}))}}}),A=i(48998);const V=(0,A.Z)(T,[["render",k],["__scopeId","data-v-4eb081c1"]]);var W=V}}]);
//# sourceMappingURL=838-legacy.4989864f.js.map